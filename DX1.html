async function handleLogin() {
    const email = document.getElementById('emailInput').value.trim();
    const btn = document.getElementById('loginBtn');
    if (!email.includes('@')) { showError("البريد غير صحيح"); return; }
    
    btn.disabled = true; btn.innerText = "جاري التحقق...";
    try {
        // أضفنا &activity=dict هنا ليتحقق من العمود C
        const res = await fetch(`${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}&action=check&activity=dict`);
        const data = await res.json();
        
        if (data.status === "authorized") {
            // أضفنا &activity=dict هنا ليعدل في العمود C
            await fetch(`${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}&action=mark_listened&activity=dict`);
            document.getElementById('loginSection').classList.add('hidden-section');
            document.getElementById('activitySection').classList.remove('hidden-section');
        } else {
            showError(data.status === "already_listened" ? "استنفدت فرصتك" : "الإيميل غير مسجل");
        }
    } catch (e) { showError("خطأ في الاتصال"); }
    btn.disabled = false; btn.innerText = "تحقق من بياناتي";
}
