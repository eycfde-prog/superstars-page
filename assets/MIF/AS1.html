<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EYC Arena | Activity Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728);
            --bg-deep: #020205;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(212, 175, 55, 0.2);
            --gold-glow: rgba(212, 175, 55, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body, html { 
            background: var(--bg-deep); 
            color: white; 
            height: 100%; 
            width: 100%;
            overflow: hidden; 
            position: fixed;
        }

        body { display: flex; flex-direction: column; }

        #star-container { position: fixed; inset: 0; z-index: -2; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.5; animation: twinkle var(--duration) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        
        header { padding: 10px; background: rgba(5, 5, 8, 0.8); border-bottom: 1px solid var(--glass-border); z-index: 10; }
        .battle-header { display: flex; justify-content: space-between; align-items: center; max-width: 900px; margin: 0 auto; width: 100%; gap: 10px; }
        .info-box { flex: 1; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 12px; padding: 5px; text-align: center; backdrop-filter: blur(10px); min-width: 100px; }
        .student-photo, .activity-logo { width: 40px; height: 40px; border-radius: 10px; margin-bottom: 2px; border: 1px solid var(--gold); object-fit: cover; }
        .name { font-family: 'Cinzel', serif; font-size: 0.65rem; color: #fff; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .sub-text { font-size: 0.55rem; color: var(--gold); text-transform: uppercase; }
        .vs-container { text-align: center; min-width: 60px; }
        .vs-text { font-family: 'Cinzel', serif; font-size: 1.2rem; font-weight: 900; background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        .token-badge { background: rgba(212, 175, 55, 0.15); border: 1px solid var(--gold); border-radius: 50px; padding: 1px 6px; font-size: 0.6rem; color: #fff; }

        .selection-bar { display: flex; justify-content: center; gap: 15px; padding: 10px 0; z-index: 10; }
        .select-btn { width: 60px; height: 40px; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 8px; color: white; font-family: 'Cinzel', serif; font-weight: 900; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .select-btn.active { background: var(--gold-gradient); color: black; box-shadow: 0 0 15px var(--gold-glow); transform: scale(1.05); }

        .arena-container { flex: 1; padding: 0 10px 10px 10px; position: relative; display: flex; justify-content: center; align-items: center; }
        .glass-iframe-wrapper { width: 100%; height: 100%; background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }

        footer { padding: 10px 15px 20px; display: flex; justify-content: space-between; align-items: center; gap: 10px; max-width: 900px; margin: 0 auto; width: 100%; z-index: 10; }
        .btn { padding: 12px 5px; border-radius: 10px; border: none; font-weight: 700; text-transform: uppercase; cursor: pointer; transition: 0.3s; font-size: 0.65rem; font-family: 'Cinzel'; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-submit { flex: 1.5; background: var(--gold-gradient); color: #000; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); }
        .btn-side { flex: 1; background: rgba(212, 175, 55, 0.1); color: var(--gold); border: 1px solid var(--gold); }
  <style>
    #activityWrapper { display: grid; grid-template-columns: 1fr; gap: 15px; width: 100%; margin-top: 10px; }
    .glass-card { 
        background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px);
        border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 15px; padding: 15px;
        transition: 0.3s;
    }
    .case-num { font-family: 'Cinzel'; font-size: 10px; color: var(--gold); opacity: 0.7; margin-bottom: 8px; display: block; }
    .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .field-group { display: flex; flex-direction: column; gap: 6px; }
    .field-group label { font-size: 14px; color: #fff; font-weight: 600; text-align: center; }
    .input-alike { 
        background: rgba(0,0,0,0.5); border: 1px solid rgba(212, 175, 55, 0.3); 
        border-radius: 10px; padding: 10px; text-align: center; color: var(--gold); 
        font-family: 'Poppins'; font-size: 16px; transition: 0.3s; width: 100%;
    }
    .input-alike:focus { border-color: var(--gold); box-shadow: 0 0 10px var(--gold-glow); outline: none; }
</style>

<div class="content-area">
    <div id="activityWrapper">
        </div>
</div>

<script>
    // ÿ¨Ÿä: ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑŸÑŸä ÿ®ÿπÿ™Ÿáÿß Ÿäÿß ŸÖÿ≥ÿ™ÿ± ÿπÿ≤
    const currentTask = [
        {m1:"ÿ•ŸÑŸâ", m2:"ÿ£Ÿäÿ∂ÿßŸã"}, {m1:"ÿßÿ®ŸÜ", m2:"ÿ¥ŸÖÿ≥"}, 
        {m1:"ŸáŸÜÿß", m2:"Ÿäÿ≥ŸÖÿπ"}, {m1:"ÿ®ÿ≠ÿ±", m2:"Ÿäÿ±Ÿâ"}, {m1:"ŸÑÿß", m2:"Ÿäÿπÿ±ŸÅ"}
    ];

    // ÿ¨Ÿä: ÿØÿßŸÑÿ© ÿßŸÑÿ±ŸÜÿØÿ± "ÿßŸÑÿØŸÑŸàÿπÿ©" ÿπÿ¥ÿßŸÜ ÿ™ŸÖŸÑŸâ ÿßŸÑŸÜÿ¥ÿßÿ∑
    function renderActivity() {
        const wrapper = document.getElementById('activityWrapper');
        if (!wrapper) return;
        wrapper.innerHTML = currentTask.map((pair, i) => `
            <div class="glass-card">
                <span class="case-num"># CASE ${i + 1}</span>
                <div class="input-grid">
                    <div class="field-group">
                        <label>${pair.m1}</label>
                        <input type="text" class="input-alike task-input" placeholder="...">
                    </div>
                    <div class="field-group">
                        <label>${pair.m2}</label>
                        <input type="text" class="input-alike task-input" placeholder="...">
                    </div>
                </div>
            </div>`).join('');
    }

    // ÿ¨Ÿä: ŸÜÿπÿØŸÑ ÿßŸÑŸÄ window.onload ÿπÿ¥ÿßŸÜ ÿ™ÿ¥ÿ∫ŸÑ ÿßŸÑÿ±ŸÜÿØÿ± ŸÖÿπ ÿ®ÿßŸÇŸä ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅÿ≠ÿ©
    const originalOnload = window.onload;
    window.onload = () => {
        if (originalOnload) originalOnload();
        renderActivity();
    };

    // ÿ¨Ÿä: ÿØÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ (ÿ™ÿ£ŸÉÿØ ÿ•ŸÜŸáÿß ŸÖŸàÿ¨ŸàÿØÿ© ŸÑÿ±ÿ®ÿ∑Ÿáÿß ÿ®ŸÄ Check Result)
    window.getStudentAnswers = function() {
        const inputs = document.querySelectorAll('.task-input');
        let answers = [];
        let allFilled = true;
        inputs.forEach(input => {
            const val = input.value.trim();
            if (!val) { 
                allFilled = false; 
                input.style.borderColor = "#ff4d4d"; 
            } else { 
                input.style.borderColor = "rgba(212, 175, 55, 0.3)"; 
            }
            answers.push(val);
        });
        return allFilled ? answers : null;
    };
</script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyaKBzNIcqv3KlFP0lIz5uFRKk6iwuMn_CGPOeL0caFBloi4iu-rNEH-yBGEuMBJA2-/exec";
        
        // ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ŸÉŸàÿßÿØ ÿ®ÿßŸÑÿ£ÿπŸÖÿØÿ© ŸÅŸä ÿßŸÑÿ¥Ÿäÿ™ (ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿ™ÿ±ÿ™Ÿäÿ® headers ŸÅŸä Apps Script)
        const COLUMN_MAP = {
            "GS": 9,  "AS": 10, "SS": 11, "VS": 12, "LS": 13, "GES": 14,
            "GX": 15, "AX": 16, "SX": 17, "VX": 18, "LX": 19, "GEX": 20,
            "FX": 21, "DX": 22, "SSSX": 23, "ELX": 24
        };

        let activityParams = new URLSearchParams(window.location.search);
        let studentData = {
            email: activityParams.get('email'),
            name: activityParams.get('name'),
            image: activityParams.get('image'),
            title: activityParams.get('title'),
            tokens: activityParams.get('totalScore'),
            activity: activityParams.get('activity'),
            taskCode: activityParams.get('taskCode'),
            taskNum: activityParams.get('taskNum')
        };

        window.onload = () => {
            if (!studentData.email && !studentData.name) {
                alert("Access Denied: Please enter through the Main Hub.");
                window.location.href = "MC.html";
                return;
            }
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            document.getElementById('userName').innerText = studentData.name;
            document.getElementById('userImg').src = studentData.image || "https://avataaars.io/?avatarStyle=Transparent";
            document.getElementById('userTitle').innerText = studentData.title;
            document.getElementById('userTokens').innerText = `ü™ô ${studentData.tokens || 0}`;
            document.getElementById('activityName').innerText = studentData.activity;
            document.getElementById('activityCodeDisplay').innerText = `${studentData.taskCode}-${studentData.taskNum}`;
            
            loadContent('A', document.querySelector('.select-btn'));
            createStars();
        };

        function loadContent(letter, btn) {
            document.querySelectorAll('.select-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const iframe = document.getElementById('arenaIframe');
            // ÿßŸÑŸÖÿ≥ÿßÿ±: assets/MIF/Code+Num+Letter.html (ŸÖÿ´ÿßŸÑ: assets/MIF/GES1_A.html)
            iframe.src = `assets/MIF/${studentData.taskCode}${studentData.taskNum}_${letter}.html`; 
        }

        async function submitResult() {
            if (studentData.email === "Guest" || !studentData.email) {
                return alert("Guest mode: Scores are not saved to the leaderboard!");
            }

            const btn = document.getElementById('submitBtn');
            const targetColumn = COLUMN_MAP[studentData.taskCode] || 9;
            const scoreToAdd = 10; // ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ™Ÿä ÿ≠ÿØÿØÿ™Ÿáÿß ÿ£ŸÜÿ™ ŸÅŸä ÿÆÿ∑ÿ™ŸÉ

            if(!confirm(`Ready to submit? This will add ${scoreToAdd} Tokens to your rank.`)) return;

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> SYNCING...';

            const callbackName = 'jsonp_submit_' + Math.round(100000 * Math.random());
            window[callbackName] = function(data) {
                delete window[callbackName];
                document.body.removeChild(script);
                if (data.status === "success") {
                    alert("Victory! Your score has been updated.");
                    window.location.href = "MC.html";
                } else {
                    alert("Error: " + data.message);
                    btn.disabled = false;
                    btn.innerText = "SUBMIT SCORE";
                }
            };

            const script = document.createElement('script');
            // ŸÜÿ≥ÿ™ÿÆÿØŸÖ JSONP ŸÑÿ™ŸÅÿßÿØŸä ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑŸÄ CORS
            script.src = `${SCRIPT_URL}?action=submitScore&email=${encodeURIComponent(studentData.email)}&score=${scoreToAdd}&col=${targetColumn}&callback=${callbackName}`;
            document.body.appendChild(script);
        }

        function createStars() {
            const container = document.getElementById('star-container');
            const count = 100;
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 2;
                star.style.width = size + 'px'; star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                container.appendChild(star);
            }
        }
    </script>
</body>
</html>
