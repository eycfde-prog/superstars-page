<body>
    <canvas id="rank-canvas"></canvas>
    <div class="container">
        <header class="rank-header">
            <a href="index.html" style="color: var(--accent-gold); text-decoration: none; font-family: 'Orbitron'; font-size: 0.8rem; letter-spacing: 2px;">
                <i class="fas fa-chevron-left"></i> RETURN TO COMMAND CENTER
            </a>
            <h1 style="margin-top: 25px;">HALL OF FAME</h1>
            <p style="opacity: 0.6;">Witness the glory of the top elite students.</p>
        </header>

        <div id="podium-container" class="podium">
             </div>

        <div id="rank-list-container" class="rank-list">
             </div>
    </div>

    <script>
        // 1. إعداد جزيئات الخلفية (كما هي)
        const canvas = document.getElementById('rank-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function initCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        class Particle {
            constructor() { this.init(); }
            init() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.char = "EYC"[Math.floor(Math.random()*3)];
                this.fontSize = Math.random() * 15 + 10;
                this.speed = Math.random() * 0.4 + 0.1;
                this.opacity = Math.random() * 0.25;
            }
            draw() {
                ctx.fillStyle = `rgba(252,194,0,${this.opacity})`;
                ctx.font = `${this.fontSize}px Orbitron`;
                ctx.fillText(this.char, this.x, this.y);
                this.y -= this.speed;
                if(this.y < -20) this.y = canvas.height + 20;
            }
        }
        function animate() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            particles.forEach(p => p.draw());
            requestAnimationFrame(animate);
        }
        window.addEventListener('resize', initCanvas);
        initCanvas();
        for(let i=0; i<40; i++) particles.push(new Particle());
        animate();

        // 2. جلب البيانات من Google Sheets
        // استبدل الرابط أدناه برابط الـ Deploy الخاص بك
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzo-bKZMA63cLa77egbsgeNzl4Xk6Z_hDbN_bfiOm7xI3nNwE0jN6MTeYG6eorcMRJJ/exec"; 

        async function fetchRanks() {
            try {
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();
                renderPodium(data.slice(0, 3));
                renderList(data.slice(3));
            } catch (error) {
                console.error("Error fetching ranks:", error);
            }
        }

        function renderPodium(top3) {
            const container = document.getElementById('podium-container');
            const [p1, p2, p3] = top3;
            
            container.innerHTML = `
                <div class="podium-item rank-2">
                    <div class="avatar-wrapper">
                        <img src="${p2?.Photo || ''}" alt="${p2?.Name}" class="avatar">
                    </div>
                    <div class="player-name">${p2?.Name || 'N/A'}</div>
                    <div class="player-xp">${p2?.Tokens || 0} TOKENS</div>
                    <div style="color: var(--accent-silver); font-size: 0.7rem; margin-top: 10px; font-family: 'Orbitron';">${p2?.Title || ''}</div>
                </div>

                <div class="podium-item rank-1">
                    <i class="fas fa-crown crown"></i>
                    <div class="avatar-wrapper">
                        <img src="${p1?.Photo || ''}" alt="${p1?.Name}" class="avatar">
                    </div>
                    <div class="player-name">${p1?.Name || 'N/A'}</div>
                    <div class="player-xp">${p1?.Tokens || 0} TOKENS</div>
                    <div style="color: var(--accent-gold); font-size: 0.7rem; margin-top: 10px; font-family: 'Orbitron';">${p1?.Title || ''}</div>
                </div>

                <div class="podium-item rank-3">
                    <div class="avatar-wrapper">
                        <img src="${p3?.Photo || ''}" alt="${p3?.Name}" class="avatar">
                    </div>
                    <div class="player-name">${p3?.Name || 'N/A'}</div>
                    <div class="player-xp">${p3?.Tokens || 0} TOKENS</div>
                    <div style="color: var(--accent-bronze); font-size: 0.7rem; margin-top: 10px; font-family: 'Orbitron';">${p3?.Title || ''}</div>
                </div>
            `;
        }

        function renderList(others) {
            const container = document.getElementById('rank-list-container');
            container.innerHTML = others.map((player, idx) => `
                <div class="rank-row">
                    <div class="player-identity">
                        <img src="${player.Photo}" class="small-avatar">
                    </div>
                    <div class="info-tubes">
                        <div class="tube-small">RANK #${(idx + 4).toString().padStart(2, '0')}</div>
                        <div class="tube-small">${player.Title}</div>
                    </div>
                    <div class="name-tube">
                        <div class="row-name">${player.Name}</div>
                        <div class="row-xp-container">${player.Tokens} TOKENS</div>
                    </div>
                </div>
            `).join('');
        }

        fetchRanks();
    </script>
</body>

