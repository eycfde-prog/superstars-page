<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GX | Grammar Extractor | Glassy Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-glow: rgba(212, 175, 55, 0.3);
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(212, 175, 55, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: transparent;
            color: white;
            margin: 0; padding: 15px;
            direction: ltr;
        }

        /* سكرول بار جلاسي */
        body::-webkit-scrollbar { width: 4px; }
        body::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        .gx-container { max-width: 900px; margin: 0 auto; animation: fadeIn 0.8s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header-gx {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; border-bottom: 1px solid var(--glass-border);
            padding-bottom: 10px;
        }

        .header-gx h1 {
            font-family: 'Orbitron'; font-size: 1rem;
            color: var(--gold); letter-spacing: 3px; margin: 0;
        }

        .principle-tags { display: flex; gap: 8px; }
        .tag {
            font-family: 'Orbitron'; font-size: 8px; color: var(--gold);
            border: 1px solid var(--glass-border); padding: 2px 6px; border-radius: 4px;
        }

        /* حاوية النص الاستخراجي */
        .passage-box {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            padding: 25px; border-radius: 18px;
            margin-bottom: 25px; line-height: 1.8;
            font-size: 1.1rem; color: #eee;
            position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .passage-box::before {
            content: "INTEL_SOURCE"; position: absolute; top: -10px; left: 20px;
            background: #020205; padding: 0 12px; font-family: 'Orbitron';
            font-size: 10px; color: var(--gold); border: 1px solid var(--glass-border);
            border-radius: 5px;
        }

        /* شبكة الاستخراج */
        .extractor-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .extraction-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 18px; border-radius: 15px;
            border-bottom: 3px solid var(--gold);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .extraction-card:hover {
            border-color: var(--gold);
            box-shadow: 0 5px 15px var(--gold-glow);
            transform: translateY(-5px);
        }

        .extraction-card label {
            display: block; font-family: 'Orbitron'; font-size: 9px;
            color: var(--gold); margin-bottom: 12px;
            text-transform: uppercase; letter-spacing: 1px;
        }

        .extraction-input {
            width: 100%; background: rgba(0,0,0,0.4);
            border: 1px solid var(--glass-border); border-radius: 8px;
            color: #fff; padding: 12px;
            font-family: 'Poppins'; font-size: 0.9rem;
            outline: none; box-sizing: border-box;
            transition: 0.3s;
        }

        .extraction-input:focus {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.05);
        }

        .requirement-tag {
            font-size: 9px; color: #666; margin-top: 8px; display: block;
            font-style: italic;
        }

        .error-card { border-color: #ff4444 !important; animation: shake 0.3s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>

<div class="gx-container">
    <div class="header-gx">
        <h1>Grammar Extractor</h1>
        <div class="principle-tags">
            <span class="tag">CLR</span>
            <span class="tag">AAI</span>
        </div>
    </div>

    <div class="passage-box" id="passage-content">
        Scanning for Intel...
    </div>

    <div class="extractor-grid" id="extractor-fields">
    </div>
</div>

<script>
const gxData = {
        "1": {
            passage: "The sun was shining brightly as the small birds flew over the green forest. Yesterday, they built a new nest because they were happy. If it rains tomorrow, they will stay inside.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., shining, flew, built" },
                { label: "Extract 2 Adjectives", hint: "e.g., small, green" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., sun, birds, forest" },
                { label: "Extract 1 Future condition", hint: "If + will..." }
            ]
        },
        "2": {
            passage: "The smart engineer is working in the office. He fixed the old laptop yesterday and now he is buying a fast computer. While he was working, his phone rang.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., working, fixed, buying" },
                { label: "Extract 2 Adjectives", hint: "e.g., smart, fast" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., engineer, office, project" },
                { label: "Extract 1 Past Continuous clause", hint: "Subject + was/were + ing" }
            ]
        },
        "3": {
            passage: "A famous chef is eating in the kitchen. She cooked a large meal for us because the spices smelled delicious. The chef has cooked many meals before.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., eating, cooked, smelled" },
                { label: "Extract 2 Adjectives", hint: "e.g., delicious, spicy" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., chef, kitchen, spices" },
                { label: "Extract 1 Present Perfect sentence", hint: "Subject + has/have + V3" }
            ]
        },
        "4": {
            passage: "The strong runner was running on the track. He won the gold medal last week because he had been training for months. He is the most athletic person I know.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., running, won, training" },
                { label: "Extract 2 Adjectives", hint: "e.g., strong, athletic" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., runner, track, medal" },
                { label: "Extract 1 Superlative Adjective", hint: "The + adjective + est" }
            ]
        },
        "5": {
            passage: "Many tourists are traveling to Egypt. They visited the Great Pyramids and saw ancient temples. If they have enough time, they will visit Luxor next week.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., traveling, visited, saw" },
                { label: "Extract 2 Adjectives", hint: "e.g., ancient, historical" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., tourists, guide, temple" },
                { label: "Extract 1 Conditional Type 1", hint: "If + present, will + inf" }
            ]
        }
const gxData = {
        // ... المهام السابقة من 1 إلى 5 ...
        "6": {
            passage: "The student was reading a useful book in the quiet library. He wrote a long story yesterday and his writing improved. While he was reading, the light went out.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., reading, wrote, improved" },
                { label: "Extract 2 Adjectives", hint: "e.g., quiet, useful" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., book, library, student" },
                { label: "Extract 1 Past Continuous clause", hint: "was/were + verb + ing" }
            ]
        },
        "7": {
            passage: "It was a hot summer, so she was swimming in the cold pool. She dove into the deep water and felt great. The water was colder than the air.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., swimming, dove, felt" },
                { label: "Extract 2 Adjectives", hint: "e.g., cold, deep" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., pool, summer, swimmer" },
                { label: "Extract 1 Comparative Adjective", hint: "Adjective + er + than" }
            ]
        },
        "8": {
            passage: "The loud dog was barking in the garden. It chased the small cat until the cat hid behind the wooden fence. The dog has chased the cat three times before.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., barking, chased, hid" },
                { label: "Extract 2 Adjectives", hint: "e.g., loud, scared" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., dog, cat, garden" },
                { label: "Extract 1 Present Perfect sentence", hint: "has/have + Past Participle" }
            ]
        },
        "9": {
            passage: "A creative artist was painting a wall in her studio. She used many colorful paints and the room looked amazing. The painting was being finished by her when I arrived.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., painting, used, looked" },
                { label: "Extract 2 Adjectives", hint: "e.g., creative, colorful" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., artist, wall, studio" },
                { label: "Extract 1 Passive Voice clause", hint: "was/were + being + V3" }
            ]
        },
        "10": {
            passage: "The careful driver was driving down the busy street. He stopped at the red light when he saw a child. If the light turns green, he will drive again.",
            requirements: [
                { label: "Extract 3 Verbs", hint: "e.g., driving, stopped, saw" },
                { label: "Extract 2 Adjectives", hint: "e.g., careful, busy" },
                { label: "Extract 1 Past Simple sentence", hint: "Write the whole sentence" },
                { label: "Extract 3 Nouns", hint: "e.g., driver, street, signal" },
                { label: "Extract 1 Conditional Type 1", hint: "If + Present, Will + Verb" }
            ]
        }
    };

    const urlParams = new URLSearchParams(window.location.search);
    const taskNum = urlParams.get('task') || "1";

    function loadExtractor() {
        const data = gxData[taskNum] || gxData["1"];
        document.getElementById('passage-content').innerText = data.passage;
        
        const grid = document.getElementById('extractor-fields');
        grid.innerHTML = data.requirements.map((req, i) => `
            <div class="extraction-card" id="card-${i}">
                <label>DATA_FIELD_0${i+1}: ${req.label}</label>
                <input type="text" class="extraction-input gx-input" id="extract-${i}" placeholder="Enter findings...">
                <span class="requirement-tag">● ${req.hint}</span>
            </div>
        `).join('');
    }

    window.addEventListener('message', function(event) {
        if (event.data.type === 'REQUEST_MISSION_DATA') {
            collectAndSend();
        }
    });

    function collectAndSend() {
        const inputs = document.querySelectorAll('.gx-input');
        let answers = [];
        let hasError = false;

        inputs.forEach((input, i) => {
            const val = input.value.trim();
            if(!val) {
                hasError = true;
                document.getElementById(`card-${i}`).classList.add('error-card');
            } else {
                document.getElementById(`card-${i}`).classList.remove('error-card');
                answers.push(val);
            }
        });

        if(hasError) {
            window.parent.postMessage({ type: 'MISSION_INCOMPLETE' }, '*');
            return;
        }

        window.parent.postMessage({ 
            type: 'MISSION_ANSWERS', 
            answers: answers.join(' | ')
        }, '*');
    }

    window.onload = loadExtractor;
</script>
</body>
</html>

