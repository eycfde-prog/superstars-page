<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Content | Dictation X</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: #fcc200; --xbox-red: #ff3c3c; --glass: rgba(255, 255, 255, 0.05); }
        
        body { background: transparent; color: white; margin: 0; padding: 15px; font-family: 'Poppins', sans-serif; overflow: hidden; }
        
        .dictation-hub {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 25px; padding: 30px 15px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .audio-controls { display: flex; flex-direction: column; gap: 20px; align-items: center; }
        
        .circle-play {
            width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--gold);
            display: flex; align-items: center; justify-content: center; font-size: 24px;
            cursor: pointer; transition: 0.4s; background: transparent; color: var(--gold);
        }
        
        /* Slow Mode Styling */
        .unit-slow .circle-play { 
            width: 100px; height: 100px; 
            background: linear-gradient(135deg, var(--gold), #d35400); 
            color: black; border: none; 
            box-shadow: 0 0 20px rgba(252, 194, 0, 0.2);
        }
        
        .timer { font-family: 'Orbitron'; font-size: 12px; color: var(--gold); margin-top: 8px; }

        /* States */
        .pulse-ring { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(252, 194, 0, 0.6); }
            70% { box-shadow: 0 0 0 15px rgba(252, 194, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(252, 194, 0, 0); }
        }
        .disabled-unit { opacity: 0.2; pointer-events: none; filter: grayscale(1); }
        
        .warning-text { color: var(--xbox-red); font-size: 10px; margin-bottom: 20px; font-weight: bold; }

        /* Hidden Answer Sheet Link (Controlled by Parent) */
        #answerSheetBtn {
            display: none; width: 100%; padding: 15px; border-radius: 15px;
            background: white; color: black; font-family: 'Orbitron'; font-weight: 900;
            margin-top: 20px; text-decoration: none; text-align: center;
            box-shadow: 0 0 20px white;
        }
    </style>
</head>
<body>

    <div class="dictation-hub">
        <p class="warning-text">⚠️ SLOW MODE: ONE ATTEMPT ONLY. CANNOT BE PAUSED.</p>

        <div class="audio-controls">
            <div class="audio-unit unit-slow" id="slowContainer">
                <p style="font-family: 'Orbitron'; font-size: 10px; color: var(--gold); margin-bottom: 5px;">GOLDEN ATTEMPT</p>
                <button class="circle-play" onclick="playAudio('slow')" id="slowBtn">
                    <i class="fas fa-play" id="slowIcon"></i>
                </button>
                <div class="timer" id="slowTimer">--:--</div>
            </div>

            <div class="audio-unit unit-normal" id="normalContainer">
                <p style="font-family: 'Orbitron'; font-size: 10px; color: #777; margin-bottom: 5px;">NORMAL MODE</p>
                <button class="circle-play" style="border-color: #777; color: #777;" onclick="playAudio('normal')" id="normalBtn">
                    <i class="fas fa-play" id="normalIcon"></i>
                </button>
                <div class="timer" id="normalTimer" style="color: #777;">--:--</div>
            </div>
        </div>

        <audio id="audioSlow"></audio>
        <audio id="audioNormal"></audio>

        <a href="#" id="answerSheetBtn" target="_blank">OPEN ANSWER SHEET</a>
    </div>

<script>
    const params = new URLSearchParams(window.location.search);
    const mNum = params.get('m') || '1';
    
    // روابط الملفات الصوتية بناءً على رقم المهمة
    const audioFiles = {
        slow: `assets/audio/DX${mNum}S.wav`,
        normal: `assets/audio/DX${mNum}N.wav`
    };

    const aSlow = document.getElementById('audioSlow');
    const aNormal = document.getElementById('audioNormal');
    let activeAudio = null;

    window.onload = () => {
        aSlow.src = audioFiles.slow;
        aNormal.src = audioFiles.normal;
    };

    function playAudio(type) {
        const audio = (type === 'slow') ? aSlow : aNormal;
        const btn = document.getElementById(type + 'Btn');
        const icon = document.getElementById(type + 'Icon');
        const otherContainer = document.getElementById((type === 'slow' ? 'normal' : 'slow') + 'Container');

        if (activeAudio && activeAudio !== audio) return;

        if (audio.paused) {
            activeAudio = audio;
            audio.play();
            icon.className = 'fas fa-pause';
            btn.classList.add('pulse-ring');
            otherContainer.classList.add('disabled-unit');
        } else {
            // الـ Slow مبيوقفش، الـ Normal بس اللي يوقف
            if (type === 'normal') {
                audio.pause();
                icon.className = 'fas fa-play';
                btn.classList.remove('pulse-ring');
                activeAudio = null;
                otherContainer.classList.remove('disabled-unit');
            }
        }

        audio.ontimeupdate = () => {
            const rem = Math.ceil(audio.duration - audio.currentTime);
            document.getElementById(type + 'Timer').innerText = formatTime(rem);
        };

        audio.onended = () => {
            btn.classList.remove('pulse-ring');
            btn.classList.add('disabled-unit');
            icon.className = 'fas fa-check';
            activeAudio = null;
            
            // فتح التحكم في التاني لو لسه مخلصش
            otherContainer.classList.remove('disabled-unit');
            
            checkCompletion();
        };
    }

    function checkCompletion() {
        // لو الطالب خلص أي واحد من الاتنين، نفتح له زرار الإجابة (أو حسب نظامك)
        const sheetBtn = document.getElementById('answerSheetBtn');
        sheetBtn.style.display = 'block';
        sheetBtn.href = `https://docs.google.com/forms/d/YOUR_FORM_ID_FOR_DX${mNum}`;
    }

    function formatTime(s) {
        if(isNaN(s)) return "00:00";
        const m = Math.floor(s/60); const sec = s%60;
        return `${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
    }

    // بروتوكول التصحيح (هنا هو مجرد التأكد من السمع)
    window.checkAnswers = function() {
        const finished = (aSlow.ended || aNormal.ended);
        return {
            status: finished ? "COMPLETED" : "IN_PROGRESS",
            points: finished ? 1 : 0
        };
    };
</script>
</body>
</html>
