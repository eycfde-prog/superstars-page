<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EYC Academy | Avataaars System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: #ffcc00; --bg-dark: #050505; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-dark); color: white; }
        .orbitron { font-family: 'Orbitron', sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 204, 0, 0.1); border-radius: 24px; }
        .avatar-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .step-screen { display: none; text-align: center; width: 100%; animation: fadeIn 0.4s; }
        .step-screen.active { display: block; }
        .option-box { border: 2px solid rgba(255,204,0,0.2); border-radius: 15px; cursor: pointer; transition: 0.3s; padding: 15px; }
        .option-box:hover, .option-box.selected { border-color: var(--gold); background: rgba(255,204,0,0.1); }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="py-12 px-4">

    <div id="avatarModal" class="avatar-modal">
        <div class="glass-card p-8 w-full max-w-lg">
            <div id="avatarLivePreview" class="mb-6 flex justify-center">
                <img id="currentAvatarImg" src="https://avataaars.io/" class="w-40 h-40 bg-white/10 rounded-full border-2 border-yellow-500">
            </div>

            <div id="step1" class="step-screen active">
                <h3 class="orbitron text-yellow-500 mb-6">STEP 1: GENDER & STYLE</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="option-box" onclick="updateConfig('topType', 'ShortHairShortFlat'); nextStep();"><i class="fas fa-male text-3xl mb-2"></i><p>MALE STYLE</p></div>
                    <div class="option-box" onclick="updateConfig('topType', 'LongHairCurvy'); nextStep();"><i class="fas fa-female text-3xl mb-2"></i><p>FEMALE STYLE</p></div>
                </div>
            </div>

            <div id="step2" class="step-screen">
                <h3 class="orbitron text-yellow-500 mb-6">STEP 2: SKIN TONE</h3>
                <div class="flex justify-center gap-2 flex-wrap">
                    <div onclick="updateConfig('skinColor', 'Black'); nextStep();" class="w-10 h-10 rounded-full border-2 cursor-pointer" style="background:#3d251e"></div>
                    <div onclick="updateConfig('skinColor', 'Brown'); nextStep();" class="w-10 h-10 rounded-full border-2 cursor-pointer" style="background:#8d5524"></div>
                    <div onclick="updateConfig('skinColor', 'Tanned'); nextStep();" class="w-10 h-10 rounded-full border-2 cursor-pointer" style="background:#f1c27d"></div>
                    <div onclick="updateConfig('skinColor', 'Light'); nextStep();" class="w-10 h-10 rounded-full border-2 cursor-pointer" style="background:#ffdbac"></div>
                </div>
            </div>

            <div id="step3" class="step-screen">
                <h3 class="orbitron text-yellow-500 mb-6">STEP 3: HAIR COLOR</h3>
                <div class="flex justify-center gap-2 flex-wrap">
                    <div onclick="updateConfig('hairColor', 'Black'); nextStep();" class="w-10 h-10 rounded-full border-2 cursor-pointer" style="background:#000"></div>
                    <div onclick="updateConfig('hairColor', 'BrownDark'); nextStep();" class="w-10 h-10 rounded-full border-2 cursor-pointer" style="background:#4b3621"></div>
                    <div onclick="updateConfig('hairColor', 'Blonde'); nextStep();" class="w-10 h-10 rounded-full border-2 cursor-pointer" style="background:#fdf5e6"></div>
                </div>
            </div>

            <div id="step4" class="step-screen">
                <h3 class="orbitron text-yellow-500 mb-6">STEP 4: ACCESSORIES</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="option-box" onclick="updateConfig('accessoriesType', 'Blank'); finishAvatar();">NONE</div>
                    <div class="option-box" onclick="updateConfig('accessoriesType', 'Prescription02'); finishAvatar();">GLASSES</div>
                </div>
            </div>

            <div class="mt-8 flex justify-between items-center border-t border-white/10 pt-4">
                <button onclick="prevStep()" class="text-gray-400 orbitron text-xs">← BACK</button>
                <span id="stepCounter" class="text-yellow-500 orbitron text-xs">1 / 4</span>
            </div>
        </div>
    </div>

    <div class="max-w-xl mx-auto">
        <form id="regForm" class="glass-card p-8 space-y-6">
            <h1 class="orbitron text-3xl text-center text-yellow-500 mb-8">AGENT REGISTRATION</h1>
            <input type="text" id="fullName" required placeholder="FULL NAME" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 text-white">
            <input type="email" id="email" required placeholder="EMAIL" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 text-white">
            
            <div onclick="openAvatarModal()" class="border-2 border-dashed border-yellow-500/20 rounded-2xl p-6 text-center cursor-pointer hover:bg-yellow-500/5 transition">
                <div id="finalPreview" class="w-24 h-24 bg-white/5 rounded-full mx-auto mb-2 overflow-hidden flex items-center justify-center">
                    <i class="fas fa-user-plus text-yellow-500 text-2xl"></i>
                </div>
                <p class="orbitron text-[10px] text-yellow-500">INITIALIZE AVATAR SYSTEM</p>
            </div>

            <button type="submit" id="submitBtn" class="w-full py-5 bg-yellow-500 text-black orbitron font-black rounded-2xl hover:scale-105 transition-all">INITIATE REGISTRATION</button>
        </form>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwiTgShsFGsT8926yv_1muFnqx3gHeeW54tV9OLrgq4vr40377fziyG12PDdTec5C6wFw/exec";
        let currentStep = 1;
        let config = {
            topType: 'ShortHairShortFlat',
            accessoriesType: 'Blank',
            hairColor: 'Black',
            facialHairType: 'Blank',
            clotheType: 'Hoodie',
            eyeType: 'Default',
            eyebrowType: 'Default',
            mouthType: 'Smile',
            skinColor: 'Light'
        };

        function updateConfig(key, val) {
            config[key] = val;
            const url = `https://avataaars.io/?avatarStyle=Transparent&topType=${config.topType}&accessoriesType=${config.accessoriesType}&hairColor=${config.hairColor}&facialHairType=${config.facialHairType}&clotheType=${config.clotheType}&eyeType=${config.eyeType}&eyebrowType=${config.eyebrowType}&mouthType=${config.mouthType}&skinColor=${config.skinColor}`;
            document.getElementById('currentAvatarImg').src = url;
        }

        function openAvatarModal() { 
            document.getElementById('avatarModal').style.display = 'flex'; 
        }

        function nextStep() { 
            if(currentStep < 4) switchStep(currentStep + 1); 
        }

        function prevStep() { 
            if(currentStep > 1) switchStep(currentStep - 1); 
            else document.getElementById('avatarModal').style.display = 'none'; 
        }

        function switchStep(s) {
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep = s;
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById('stepCounter').innerText = `${currentStep} / 4`;
        }

        // الدالة المدمجة حديثاً لإنهاء التخصيص
        function finishAvatar() {
            document.getElementById('avatarModal').style.display = 'none';
            const finalUrl = document.getElementById('currentAvatarImg').src;
            document.getElementById('finalPreview').innerHTML = `<img src="${finalUrl}" class="w-full h-full object-cover">`;
        }

        document.getElementById('regForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = "SYNCHRONIZING...";
            btn.disabled = true;

            const payload = {
                name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                image: document.getElementById('currentAvatarImg').src
            };

            try {
                const response = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
                const result = await response.text();
                alert(result.includes("Success") ? "AGENT REGISTERED!" : result);
                if(result.includes("Success")) location.reload();
            } catch (err) {
                alert("Connection Error");
            } finally {
                btn.innerText = "INITIATE REGISTRATION";
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
