<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EYC Activity Hub | Starry Mission</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* الإبقاء على المتغيرات والأساسيات كما هي */
    :root {
        --primary-bg: #020205;
        --accent-gold: #ffcc00;
        --neon-blue: #00d2ff;
        --ui-border: rgba(255, 204, 0, 0.4);
    }

    /* --- Vault Styles --- */
    .vault-container {
        position: relative;
        width: 320px;
        height: 320px;
        margin: 40px auto;
        display: flex;
        align-items: center;
        justify-content: center;
        touch-action: none;
    }

    .vault-outer-ring {
        position: absolute;
        width: 100%;
        height: 100%;
        border: 8px solid #1a1a1a;
        border-radius: 50%;
        box-shadow: 0 0 30px rgba(255, 204, 0, 0.2), inset 0 0 20px #000;
    }

    .vault-dial {
        position: relative;
        width: 280px;
        height: 280px;
        background: radial-gradient(circle, #222 0%, #000 70%);
        border: 4px solid var(--accent-gold);
        border-radius: 50%;
        transition: transform 0.5s cubic-bezier(0.1, 0.7, 0.3, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
    }

    .dial-mark {
        position: absolute;
        width: 2px;
        height: 15px;
        background: var(--accent-gold);
        top: 5px;
        left: 50%;
        transform-origin: 50% 135px;
    }

    .activity-label {
        position: absolute;
        font-family: 'Orbitron';
        font-size: 10px;
        color: #aaa;
        width: 80px;
        text-align: center;
        pointer-events: none;
    }

    .activity-label.active {
        color: var(--accent-gold);
        text-shadow: 0 0 10px var(--accent-gold);
        font-weight: 900;
        font-size: 12px;
    }

    .launch-hub {
        position: absolute;
        width: 100px;
        height: 100px;
        background: radial-gradient(circle, #ffcc00, #b89600);
        border-radius: 50%;
        z-index: 10;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 30px rgba(255, 204, 0, 0.6);
        border: 5px solid #000;
        cursor: pointer;
        transition: 0.2s;
    }

    .launch-hub:active { transform: scale(0.9); }
    .launch-hub span { font-family: 'Orbitron'; font-weight: 900; color: #000; font-size: 14px; }

    /* Indicator Arrow */
    .vault-indicator {
        position: absolute;
        top: -20px;
        color: var(--accent-gold);
        font-size: 24px;
        z-index: 5;
        text-shadow: 0 0 10px var(--accent-gold);
    }

    #current-selection-name {
        text-align: center;
        font-family: 'Orbitron';
        color: #fff;
        margin-top: 10px;
        letter-spacing: 2px;
        height: 20px;
    }

    /* Keep other original styles from your code */
    /* ... (rest of your original styles here) ... */
</style>

<div class="rank-header" id="mainHeader">
    <h1 style="font-family:'Orbitron'; letter-spacing:3px;">VAULT COMMAND</h1>
    <p id="sub-title" style="font-size:8px; color:var(--accent-gold); font-family:'Orbitron'; letter-spacing:2px;">ROTATE TO SELECT MISSION</p>
</div>

<div class="toggle-container" id="mainToggle">
    <button class="mode-btn active season-mode" onclick="switchMode('season')">SEASON</button>
    <button class="mode-btn xbox-mode" onclick="switchMode('xbox')">XBOX ELITE</button>
</div>

<div id="vault-interface">
    <div class="vault-container" id="vaultContainer">
        <div class="vault-indicator"><i class="fas fa-caret-down"></i></div>
        <div class="vault-outer-ring"></div>
        <div class="vault-dial" id="mainDial">
            </div>
        <div class="launch-hub" onclick="handleLaunch()">
            <span>LAUNCH</span>
        </div>
    </div>
    <div id="current-selection-name">READY</div>
</div>

<button class="back-btn" id="backBtn" onclick="resetView()">RESET VAULT</button>

<script>
    let currentMode = 'season';
    let currentRotation = 0;
    let selectedIndex = 0;
    let isMissionPhase = false; // هل نحن في مرحلة اختيار المهمة (M1..M10)؟
    let activitySelected = null;

    const activities = {
        season: [
            { name: 'Golden Ear', code: 'GES', icon: 'fa-ear-listen' },
            { name: 'Seeds', code: 'SS', icon: 'fa-seedling' },
            { name: 'Label', code: 'LS', icon: 'fa-tag' },
            { name: 'Grammar', code: 'GS', icon: 'fa-magnifying-glass' },
            { name: 'Vivid', code: 'VS', icon: 'fa-eye' },
            { name: 'Alike', code: 'AS', icon: 'fa-equals' }
        ],
        xbox: [
            { name: 'Golden Ear X', code: 'GEX', icon: 'fa-filter' },
            { name: 'Alike X', code: 'AX', icon: 'fa-clone' },
            { name: 'Seeds X', code: 'SX', icon: 'fa-puzzle-piece' },
            { name: 'Grammar X', code: 'GX', icon: 'fa-network-wired' },
            { name: 'Label X', code: 'LX', icon: 'fa-industry' },
            { name: 'Vivid X', code: 'VX', icon: 'fa-stopwatch' },
            { name: 'Figurative X', code: 'FX', icon: 'fa-mask' },
            { name: 'Dictation X', code: 'DX', icon: 'fa-pen-nib' },
            { name: 'SSS X', code: 'SSSX', icon: 'fa-bolt' },
            { name: 'Elmagazine X', code: 'ELX', icon: 'fa-microphone-lines' }
        ]
    };

    function initVault(type) {
        const dial = document.getElementById('mainDial');
        dial.innerHTML = '';
        const data = isMissionPhase ? Array.from({length:10}, (_,i)=>({name:`MISSION M${i+1}`, id:i+1})) : activities[type];
        const step = 360 / data.length;

        data.forEach((item, i) => {
            const angle = i * step;
            // Marks
            const mark = document.createElement('div');
            mark.className = 'dial-mark';
            mark.style.transform = `rotate(${angle}deg)`;
            dial.appendChild(mark);

            // Labels
            const label = document.createElement('div');
            label.className = 'activity-label';
            const radius = 100;
            const x = Math.sin(angle * Math.PI / 180) * radius;
            const y = -Math.cos(angle * Math.PI / 180) * radius;
            label.style.transform = `translate(${x}px, ${y}px) rotate(${angle}deg)`;
            label.innerText = isMissionPhase ? `M${item.id}` : item.name;
            label.id = `label-${i}`;
            dial.appendChild(label);
        });
        
        updateSelectionName();
    }

    // Touch Handling for Rotation
    let startAngle = 0;
    const dialElement = document.getElementById('vaultContainer');

    dialElement.addEventListener('touchstart', (e) => {
        const rect = dialElement.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        startAngle = Math.atan2(e.touches[0].clientY - centerY, e.touches[0].clientX - centerX) * 180 / Math.PI;
    });

    dialElement.addEventListener('touchmove', (e) => {
        const rect = dialElement.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const currentAngle = Math.atan2(e.touches[0].clientY - centerY, e.touches[0].clientX - centerX) * 180 / Math.PI;
        const delta = currentAngle - startAngle;
        
        currentRotation += delta;
        document.getElementById('mainDial').style.transform = `rotate(${currentRotation}deg)`;
        startAngle = currentAngle;
        calculateSelected();
    });

    function calculateSelected() {
        const data = isMissionPhase ? 10 : activities[currentMode].length;
        const step = 360 / data;
        const normalizedRotation = ((-currentRotation % 360) + 360) % 360;
        selectedIndex = Math.round(normalizedRotation / step) % data;
        
        document.querySelectorAll('.activity-label').forEach(l => l.classList.remove('active'));
        const activeLabel = document.getElementById(`label-${selectedIndex}`);
        if(activeLabel) activeLabel.classList.add('active');
        updateSelectionName();
    }

    function updateSelectionName() {
        const nameDisplay = document.getElementById('current-selection-name');
        if(isMissionPhase) {
            nameDisplay.innerText = `READY FOR MISSION ${selectedIndex + 1}`;
        } else {
            nameDisplay.innerText = activities[currentMode][selectedIndex].name.toUpperCase();
        }
    }

    function handleLaunch() {
        if (!isMissionPhase) {
            // التحول لاختيار المهمة
            activitySelected = activities[currentMode][selectedIndex];
            isMissionPhase = true;
            currentRotation = 0;
            document.getElementById('mainDial').style.transform = `rotate(0deg)`;
            document.getElementById('sub-title').innerText = `SELECT MISSION FOR ${activitySelected.name}`;
            initVault();
            calculateSelected();
        } else {
            // تنفيذ الإطلاق الفعلي
            const missionNum = selectedIndex + 1;
            if(!isLogged) {
                openLogin();
            } else {
                const targetPage = (currentMode === 'season') ? 'MissionNormal.html' : 'MissionX.html';
                const params = new URLSearchParams({
                    act: activitySelected.code,
                    m: missionNum,
                    name: activitySelected.name,
                    file: activitySelected.code + missionNum
                });
                window.location.href = `${targetPage}?${params.toString()}`;
            }
        }
    }

    function switchMode(mode) {
        if(isMissionPhase) return; // منع التغيير أثناء اختيار المهمة
        currentMode = mode;
        document.querySelector('.season-mode').classList.toggle('active', mode === 'season');
        document.querySelector('.xbox-mode').classList.toggle('active', mode === 'xbox');
        currentRotation = 0;
        document.getElementById('mainDial').style.transform = `rotate(0deg)`;
        initVault(mode);
        calculateSelected();
    }

    function resetView() {
        isMissionPhase = false;
        switchMode(currentMode);
        document.getElementById('sub-title').innerText = "ROTATE TO SELECT MISSION";
    }

    // Initialize on load
    window.addEventListener('DOMContentLoaded', () => {
        initVault('season');
        checkSavedAgent();
        initStars();
    });
</script>

</body>
</html>
