<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar X - The Language Hunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --dark-gold: #996515;
            --xbox-green: #107c10;
        }
        body {
            background-color: #050505;
            color: white;
            font-family: 'Exo 2', sans-serif;
            background-image: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #050505 100%);
            min-height: 100vh;
        }
        .header-font { font-family: 'Orbitron', sans-serif; }
        
        .gold-border {
            border: 1px solid var(--gold);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
        }
        
        .gold-gradient-text {
            background: linear-gradient(to bottom, #f1c40f, #d4af37, #996515);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: white;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .glow-button {
            background: linear-gradient(135deg, var(--dark-gold), var(--gold));
            color: black;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }
        .glow-button:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 0 25px var(--gold);
        }
        .glow-button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .task-card {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(10px);
        }

        .hidden-section { display: none; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header Section -->
        <div class="text-center mb-10 relative">
            <h1 class="header-font text-5xl md:text-6xl font-black gold-gradient-text tracking-tighter mb-2">GRAMMAR X</h1>
            <p class="text-xs tracking-[0.4em] text-gray-400 uppercase">Season: The Language Hunter</p>
            <div class="h-1 w-32 bg-gradient-to-r from-transparent via-[#d4af37] to-transparent mx-auto mt-4"></div>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="task-card p-8 rounded-2xl gold-border text-center max-w-md mx-auto">
            <h2 class="header-font text-[#d4af37] text-xl mb-6">IDENTIFICATION REQUIRED</h2>
            <input type="text" id="emailInput" class="input-field w-full py-4 px-6 rounded-xl mb-4 text-center text-lg" placeholder="Enter Email or Student Code">
            <div id="errorMessage" class="mb-4 text-red-500 text-xs font-bold hidden bg-red-900/10 p-2 border border-red-500/20 rounded"></div>
            <button onclick="handleLogin()" id="loginBtn" class="glow-button w-full py-4 rounded-xl">Initialize Mission</button>
        </div>

        <!-- Activity Section (Hidden by default) -->
        <div id="activitySection" class="hidden-section">
            <!-- Welcome Badge -->
            <div class="task-card p-4 rounded-xl gold-border mb-8 flex justify-between items-center border-l-4 border-l-[#d4af37]">
                <div>
                    <p class="text-gray-400 text-xs uppercase tracking-widest">Active Hunter</p>
                    <p id="displayEmail" class="text-[#d4af37] font-bold">---</p>
                </div>
                <div class="text-right">
                    <p class="text-gray-400 text-xs uppercase tracking-widest">Hunter ID</p>
                    <p id="displayCode" class="text-white font-mono font-bold tracking-tighter">---</p>
                </div>
            </div>

            <!-- Instructions Box -->
            <div class="task-card p-6 rounded-2xl gold-border mb-8 border-l-4 border-l-[#d4af37]">
                <h3 class="header-font text-[#d4af37] font-bold mb-2">MISSION BRIEFING:</h3>
                <p class="text-gray-300 text-sm leading-relaxed">
                    Identify and extract the precise number of linguistic elements. No room for error. It's either the exact count or mission failure. <span class="text-[#d4af37]">Be 100% accurate.</span>
                </p>
            </div>

 <!-- Text Content Area -->
            <div class="task-card p-8 rounded-2xl gold-border mb-8">
                <label class="block header-font text-xs text-gray-500 mb-4 uppercase tracking-widest">Target Text Area</label>
                <!-- يا مستر تقدر تغير نص القطعة من هنا -->
                <div id="passageDisplay" class="text-xl md:text-2xl font-light italic text-gray-200 border-l-2 border-[#d4af37] pl-6 py-4 bg-white/5 rounded-r-lg">
                   The modern world is changing rapidly due to amazing technology. Small robots are now helping doctors in busy hospitals to perform difficult surgeries. Yesterday, a famous scientist spoke about the future of artificial intelligence. He claimed that smart machines will eventually learn to think like humans. Many people feel excited, but others are worried about their jobs. In the silence of the laboratory, the scientist carefully examined a new microchip. It was glowing with a faint blue light. This tiny invention could potentially solve many global problems. We must understand that progress requires patience and continuous learning..
                </div>
            </div>

            <!-- Activity Form -->
            <form id="grammarForm" class="space-y-8">
                <div id="requirementsContainer" class="space-y-6">
                    <!-- التوليد التلقائي للمهام -->
                    <script>
                        // يا مستر غير المطالب من هنا (مثلاً: 5 Verbs، 5 Nouns، إلخ)
                        const missions = [
                            "5 Verbs",
                            "5 Adjectives",
                            "5 Adjectives",
                            "5 Prepositions",
                            "5 Adverbs"
                        ];

                        missions.forEach((missionTitle, index) => {
                            document.write(`
                            <div class="task-card p-6 rounded-xl border border-white/10 hover:border-[#d4af37]/50 transition-colors">
                                <h4 class="text-[#d4af37] font-bold mb-4 header-font text-lg mission-title">${missionTitle}</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-5 gap-3">
                                    <input type="text" placeholder="1" class="input-field p-3 rounded-lg text-sm mission-input" required>
                                    <input type="text" placeholder="2" class="input-field p-3 rounded-lg text-sm mission-input" required>
                                    <input type="text" placeholder="3" class="input-field p-3 rounded-lg text-sm mission-input" required>
                                    <input type="text" placeholder="4" class="input-field p-3 rounded-lg text-sm mission-input" required>
                                    <input type="text" placeholder="5" class="input-field p-3 rounded-lg text-sm mission-input" required>
                                </div>
                            </div>
                            `);
                        });
                    </script>
                </div>

                <div class="text-center pt-10">
                    <button type="submit" id="submitBtn" class="glow-button px-12 py-4 rounded-full text-xl flex items-center gap-3 mx-auto">
                        <span>Submit Mission</span>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                    </button>
                    <p id="statusMsg" class="mt-4 text-sm font-bold uppercase tracking-widest"></p>
                </div>
            </form>
        </div>
        
        <footer class="mt-12 text-center text-gray-600 text-[10px] tracking-[0.5em] uppercase">
            &copy; 2026 GRAMMAR X SYSTEM | THE LANGUAGE HUNTER
        </footer>
    </div>

    <script>
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxRkYp14qpPdZJvq6f_T0NPKRGVoSUfcjWTZoSzZhbegKGc4QnsKwyx2jr52sl7vQIi_g/exec";
        let currentUserKey = "";

        // --- Login Logic ---
        async function handleLogin() {
            const input = document.getElementById('emailInput').value.trim();
            const btn = document.getElementById('loginBtn');
            const err = document.getElementById('errorMessage');
            
            if (input.length < 3) {
                showError("INPUT TOO SHORT");
                return;
            }

            btn.disabled = true;
            btn.innerText = "VERIFYING...";
            err.classList.add('hidden');

            try {
                const response = await fetch(`${APPS_SCRIPT_URL}?action=check&email=${encodeURIComponent(input)}`);
                const data = await response.json();

                if (data.status === "authorized") {
                    currentUserKey = data.email || input;
                    document.getElementById('displayEmail').innerText = data.email;
                    document.getElementById('displayCode').innerText = data.studentCode;
                    
                    document.getElementById('loginSection').classList.add('hidden-section');
                    document.getElementById('activitySection').classList.remove('hidden-section');
                } else if (data.status === "already_done") {
                    showError("MISSION ALREADY COMPLETED");
                } else {
                    showError("IDENTIFICATION FAILED");
                }
            } catch (e) {
                showError("SERVER CONNECTION ERROR");
            } finally {
                btn.disabled = false;
                btn.innerText = "Initialize Mission";
            }
        }

        function showError(m) {
            const e = document.getElementById('errorMessage');
            e.innerText = m;
            e.classList.remove('hidden');
        }

        // --- Form Submission Logic ---
        const form = document.getElementById('grammarForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusMsg = document.getElementById('statusMsg');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            submitBtn.disabled = true;
            statusMsg.textContent = 'Transmitting data to HQ...';
            statusMsg.style.color = '#d4af37';

            // تجميع الإجابات في نص واحد بفاصلات
            let fullAnswer = "";
            const rows = document.querySelectorAll('#requirementsContainer > div');
            
            rows.forEach((row, index) => {
                const title = row.querySelector('input[type="text"]').value;
                const inputs = Array.from(row.querySelectorAll('.grid input')).map(i => i.value).join(', ');
                fullAnswer += `Task ${index + 1} (${title}): [${inputs}] | `;
            });

            try {
                // إرسال البيانات للأب سكريبت بالأكشن submit_all
                const finalUrl = `${APPS_SCRIPT_URL}?action=submit_all&userKey=${encodeURIComponent(currentUserKey)}&answers=${encodeURIComponent(fullAnswer)}`;
                
                // استخدام fetch مع mode no-cors لأن جوجل سكريبت أحياناً يرفض الـ Redirect
                await fetch(finalUrl, { method: 'GET', mode: 'no-cors' });

                statusMsg.textContent = 'MISSION ACCOMPLISHED! DATA SECURED.';
                statusMsg.style.color = '#107c10';
                form.innerHTML = `<div class="p-10 text-center gold-border rounded-2xl bg-xbox-green/10">
                    <h2 class="header-font text-2xl text-white mb-2">WELL DONE, HUNTER!</h2>
                    <p class="text-gray-400">Your mission data has been encrypted and stored.</p>
                </div>`;
            } catch (error) {
                statusMsg.textContent = 'TRANSMISSION FAILED. RETRY.';
                statusMsg.style.color = '#ff0000';
                submitBtn.disabled = false;
            }
        });

        // منع إغلاق الصفحة بالخطأ
        window.onbeforeunload = () => currentUserKey ? "Mission in progress! Are you sure?" : null;
    </script>
</body>
</html>


