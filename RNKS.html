<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Ranks | EYC Elite</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --gold: #D4AF37;
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728);
            --bg-deep: #050508;
            --card-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(212, 175, 55, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg-deep); color: white; overflow-x: hidden; min-height: 100vh; }

        /* Loader - Premium Scan */
        #matrix-loader {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease;
        }
        .scan-bar {
            width: 200px; height: 2px; background: var(--gold-gradient);
            box-shadow: 0 0 15px var(--gold);
            animation: scanAnim 2s infinite ease-in-out;
        }
        @keyframes scanAnim { 0%, 100% { transform: scaleX(0.5); opacity: 0.3; } 50% { transform: scaleX(1.5); opacity: 1; } }

        /* Background Glow */
        .bg-glow {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% -20%, rgba(212, 175, 55, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 40px 20px; }

        /* Header Section */
        .rank-header { text-align: center; margin-bottom: 60px; }
        .rank-header p { color: var(--gold); font-family: 'Orbitron'; font-size: 0.7rem; letter-spacing: 5px; margin-bottom: 10px; }
        .rank-header h1 { 
            font-family: 'Cinzel', serif; font-size: clamp(2rem, 5vw, 3.5rem); 
            letter-spacing: 2px; background: var(--gold-gradient);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* Podium - The Big Three */
        .podium { 
            display: flex; justify-content: center; align-items: flex-end; 
            gap: 20px; margin-bottom: 80px; display: none; 
        }
        .podium-item {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 30px; padding: 30px 15px; text-align: center; 
            position: relative; transition: 0.5s; backdrop-filter: blur(10px);
        }
        .rank-1 { width: 320px; order: 2; border-color: var(--gold); box-shadow: 0 10px 40px rgba(212, 175, 55, 0.15); z-index: 10; }
        .rank-2 { width: 260px; order: 1; opacity: 0.9; }
        .rank-3 { width: 260px; order: 3; opacity: 0.8; }

        .tier-tag {
            font-family: 'Orbitron'; font-size: 0.6rem; font-weight: 900;
            padding: 4px 12px; border-radius: 50px; text-transform: uppercase;
            background: var(--gold-gradient); color: #000; margin-bottom: 15px; display: inline-block;
        }

        .avatar-frame {
            width: 100px; height: 100px; margin: 0 auto 15px;
            border-radius: 25px; border: 2px solid var(--gold);
            padding: 5px; position: relative;
        }
        .avatar { width: 100%; height: 100%; border-radius: 20px; object-fit: cover; }
        .rank-1 .avatar-frame { width: 130px; height: 130px; }

        .crown-icon {
            position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
            font-size: 2.5rem; color: var(--gold); filter: drop-shadow(0 0 10px var(--gold));
            animation: float 3s infinite ease-in-out;
        }
        @keyframes float { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-10px); } }

        /* Rank List - The Rest */
        .rank-list { display: flex; flex-direction: column; gap: 12px; display: none; }
        .rank-row {
            display: grid; grid-template-columns: 50px 70px 1.5fr 1fr 1.2fr;
            align-items: center; background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.03); padding: 12px 20px; border-radius: 18px;
            transition: 0.3s;
        }
        .rank-row:hover { 
            background: rgba(212, 175, 55, 0.05); 
            border-color: var(--gold);
            transform: scale(1.02);
        }

        .tk-text { color: var(--gold); font-family: 'Orbitron'; font-weight: 700; font-size: 1rem; }
        .sub-stats { font-size: 0.7rem; color: #888; margin-top: 3px; }

        @media (max-width: 768px) {
            .podium { flex-direction: column; align-items: center; }
            .rank-1, .rank-2, .rank-3 { width: 100%; order: unset; }
            .rank-row { grid-template-columns: 40px 60px 1fr 100px; }
            .row-achievement { display: none; }
        }
    </style>
</head>
<body>

    <div id="matrix-loader">
        <div class="scan-bar"></div>
        <p style="font-family: 'Orbitron'; color: var(--gold); margin-top: 20px; font-size: 0.7rem; letter-spacing: 3px;">FETCHING ELITE DATA</p>
        <div id="loading-percent" style="font-family: 'Orbitron'; color: #fff; margin-top: 10px; font-size: 0.9rem;">0%</div>
    </div>

    <div class="bg-glow"></div>

    <div class="container">
        <header class="rank-header">
            <p>EYC PREMIUM SYSTEM</p>
            <h1>HALL OF FAME</h1>
        </header>

        <div class="podium" id="podium-container"></div>
        <div class="rank-list" id="ranks-container"></div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwEsuKyZibGlGIFHftqgTN3X-8n0mCB-cdKiaUehPAZEYc7qySlWbEx7bTjfhwepX27/exec';

        async function fetchRanks() {
            simulateLoading();
            try {
                const response = await fetch(scriptURL + "?action=leaderboard");
                const data = await response.json();
                renderData(data);
                
                // إخفاء الـ Loader
                setTimeout(() => {
                    document.getElementById('matrix-loader').style.opacity = '0';
                    setTimeout(() => document.getElementById('matrix-loader').remove(), 1000);
                }, 1000);
            } catch (error) {
                console.error('Data Fetch Error:', error);
            }
        }

        function simulateLoading() {
            let p = 0;
            const interval = setInterval(() => {
                p += Math.floor(Math.random() * 15);
                if (p > 100) p = 100;
                document.getElementById('loading-percent').innerText = `${p}%`;
                if (p === 100) clearInterval(interval);
            }, 100);
        }

function renderData(data) {
            const podiumContainer = document.getElementById('podium-container');
            const ranksContainer = document.getElementById('ranks-container');

            // 1. معالجة بيانات منصة التتويج (أول 3 مراكز)
            const top3 = data.slice(0, 3);
            const order = [1, 0, 2]; // الترتيب البصري: الثاني على اليسار، الأول في المنتصف، الثالث على اليمين
            let podiumHTML = '';
            
            order.forEach(displayIdx => {
                const student = top3[displayIdx];
                if (!student) return;

                // تنبيه: idx هنا هو ترتيبه الحقيقي في الداتا
                const isGold = displayIdx === 0; 
                
                podiumHTML += `
                    <div class="podium-item rank-${displayIdx + 1}">
                        ${isGold ? '<i class="fas fa-crown crown-icon"></i>' : ''}
                        <div class="tier-tag">${student.Title || 'Greeny'}</div>
                        <div class="avatar-frame">
                            <img src="${student.Image || 'https://via.placeholder.com/150'}" class="avatar">
                        </div>
                        <h3 style="font-family: 'Cinzel'; font-size: 1.1rem;">${student.Name}</h3>
                        <div class="tk-text" style="margin: 8px 0;">${student.Tokens || 0} <span style="font-size:0.6rem">TK</span></div>
                        <div class="sub-stats">Rank #${student.Rank} • ELITE AGENT</div>
                    </div>
                `;
            });
            podiumContainer.innerHTML = podiumHTML;
            podiumContainer.style.display = 'flex';

            // 2. معالجة قائمة بقية الأبطال
            let listHTML = '';
            data.slice(3).forEach((student) => {
                listHTML += `
                    <div class="rank-row">
                        <div style="font-family: 'Orbitron'; color: var(--gold); font-weight: 900;">#${student.Rank}</div>
                        <div class="avatar-frame" style="width:50px; height:50px; margin:0; border-radius:12px;">
                            <img src="${student.Image || 'https://via.placeholder.com/150'}" class="avatar" style="border-radius:10px;">
                        </div>
                        <div>
                            <div style="font-family:'Cinzel'; font-size: 0.9rem; font-weight:700;">${student.Name}</div>
                            <div style="font-size:0.6rem; color:var(--gold); text-transform:uppercase; letter-spacing:1px;">${student.Title || 'Warrior'}</div>
                        </div>
                        <div class="tk-text">${student.Tokens || 0} <span style="font-size:0.6rem">TK</span></div>
                        <div class="row-achievement" style="font-size:0.7rem; color:#666; text-align:right;">
                             MISSION ACTIVE
                        </div>
                    </div>
                `;
            });
            ranksContainer.innerHTML = listHTML;
            ranksContainer.style.display = 'flex';
        }

        fetchRanks();
    </script>
</body>
</html>
