<script>
    // الرابط الصحيح بعد عمل Publish to Web واختيار CSV
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1FrURjUbaWGVvS5p7JPRan7AKLpGDUrij/pub?output=csv';

    async function loadAllRanks() {
        try {
            console.log("Starting to fetch data...");
            const response = await fetch(SHEET_URL);
            if (!response.ok) throw new Error("فشل الوصول للرابط - تأكد من عمل Publish to web");
            
            const csvData = await response.text();
            const rows = csvToJson(csvData);
            console.log("Data loaded successfully:", rows);

            // تصفية البيانات لكل قسم (نفترض وجود عمود يحدد نوع الرانك أو تحميل الشيت كاملاً)
            // ملاحظة: بما أنك طلبت 3 صفحات مختلفة، الأفضل جلب كل صفحة برابطها الخاص
            // أو جلب الشيت الرئيسي وتوزيعه
            
            renderMaster(rows);
            renderXbox(rows);
            renderSeason(rows);

        } catch (error) {
            console.error("خطأ في التحميل:", error);
            document.body.innerHTML += `<div style="color:red; text-align:center; padding:20px;">حدث خطأ في جلب البيانات: ${error.message}</div>`;
        }
    }

    function csvToJson(csv) {
        const lines = csv.split('\n');
        const headers = lines[0].split(',').map(h => h.trim());
        return lines.slice(1).map(line => {
            const values = line.split(',');
            return headers.reduce((obj, header, i) => {
                obj[header] = values[i] ? values[i].trim() : '';
                return obj;
            }, {});
        });
    }

    function renderMaster(data) {
        const body = document.getElementById('master-body');
        if(!body) return;
        body.innerHTML = data.map(st => `
            <tr>
                <td class="rank-number">#${st['الترتيب'] || '-'}</td>
                <td>${st['اسم الطالب'] || 'بدون اسم'}</td>
                <td>${st['اللقب'] || '-'}</td>
                <td>${st['عدد التوكينز'] || '0'}</td>
                <td class="stars-count">${st['عدد النجوم'] || '0'}</td>
            </tr>
        `).join('');
    }

    // استدعاء الوظيفة عند تحميل الصفحة
    window.addEventListener('DOMContentLoaded', loadAllRanks);
</script>
