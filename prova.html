<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EYC Activity Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        :root {
            --primary-bg: #050505;
            --accent-gold: #ffcc00;
            --season-color: #00ffa3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', 'Orbitron', sans-serif; }
        body { background: var(--primary-bg); color: #fff; overflow: hidden; height: 100vh; }

        /* Floating UI Elements */
        .floating-container {
            position: fixed; bottom: 20px; left: 20px;
            display: flex; flex-direction: column; gap: 10px; z-index: 3000;
        }
        .float-circle {
            border-radius: 50%; border: 2px solid var(--accent-gold);
            display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(255,204,0,0.3); overflow: hidden;
        }
        #user-img-float { width: 70px; height: 70px; }
        #user-tokens-float { width: 50px; height: 50px; font-size: 12px; color: var(--accent-gold); font-weight: bold; }
        #user-rank-float { width: 40px; height: 40px; font-size: 10px; color: #fff; border-color: #fff; }
        #user-img-float img { width: 100%; height: 100%; object-fit: cover; }

        /* Auth Modal */
        #auth-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 4000;
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px);
        }
        .modal-content {
            background: #111; border: 2px solid var(--accent-gold); padding: 30px;
            border-radius: 25px; width: 90%; max-width: 400px; text-align: center;
        }
        .modal-input {
            width: 100%; background: #222; border: 1px solid #444; padding: 12px;
            margin: 10px 0; border-radius: 12px; color: #fff; text-align: center;
        }
        .modal-btn {
            width: 100%; background: var(--accent-gold); color: #000; padding: 12px;
            border: none; border-radius: 12px; font-weight: 900; cursor: pointer; margin-top: 10px;
        }
        .github-btn {
            background: transparent; border: 1px solid #555; color: #fff; margin-top: 15px; font-size: 12px;
        }
        
        /* Rest of Styles... (Keep previous CSS for Swiper and Header) */
        #rank-canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.3; }
        .header-area { text-align: center; padding: 20px; }
        .header-area h1 { font-family: 'Orbitron'; color: var(--accent-gold); letter-spacing: 3px; }
    </style>
</head>
<body>

    <canvas id="rank-canvas"></canvas>

    <div class="floating-container" id="floating-ui" style="display: none;">
        <div class="float-circle" id="user-img-float"><img id="profile-pic" src="" alt=""></div>
        <div class="float-circle" id="user-tokens-float"><span id="token-val">0</span></div>
        <div class="float-circle" id="user-rank-float">Rank: <span id="rank-val">0</span></div>
    </div>

    <div id="auth-modal">
        <div class="modal-content">
            <h2 style="color: var(--accent-gold); font-family: 'Orbitron';">EYC LOGIN</h2>
            <div id="login-fields">
                <input type="email" id="email-input" class="modal-input" placeholder="Enter Email">
                <input type="password" id="pass-input" class="modal-input" placeholder="Access Code (Password)">
                <button class="modal-btn" onclick="handleAuthAction()">ACCESS HUB</button>
            </div>
            <div id="no-email-box" style="display: none; margin-top: 20px;">
                <p style="font-size: 12px; color: #ccc;">If you don't have a profile email, create one now:</p>
                <button class="modal-btn github-btn" onclick="window.location.href='https://github.com/USERNAME/NP.html'">CREATE PROFILE (NP.html)</button>
            </div>
        </div>
    </div>

    <div class="header-area" id="header-area">
        <h1>EYC ACADEMY</h1>
        <p style="color: var(--accent-gold); font-size: 10px;">MISSION CONTROL</p>
    </div>

    <div id="swiper-container" class="swiper">
        <div class="swiper-wrapper" id="activities-wrapper"></div>
    </div>

    <script>
        const VENS_URL = "https://script.google.com/macros/s/AKfycbwMFxX0jv8-o8r4IymfCQ5IQTDq8OTIdyrobeR2FXF6xPhPoxwrdfCyVQQaXAMKtAGz/exec"; // استبدل بـ URL شيت الفينز
        const RANKS_URL = "https://script.google.com/macros/s/AKfycbwjEpcjO4wzWeG1PuQEsx5NI4g3oSMq-S4DVjUw8__qRR7kwnsrCD_Rt2IQb3AoPKMS/exec"; // استبدل بـ URL شيت الرانكس

        let currentUser = JSON.parse(localStorage.getItem('eyc_user')) || null;

        window.onload = async () => {
            if (currentUser) {
                const isStillActive = await verifySession();
                if (isStillActive) {
                    loadFloatingUI();
                } else {
                    openLoginModal();
                }
            } else {
                openLoginModal();
            }
        };

        function openLoginModal() { 
            document.getElementById('auth-modal').style.display = 'flex'; 
        }

        async function verifySession() {
            try {
                const r = await fetch(VENS_URL, { method: 'POST', body: JSON.stringify({ action: 'verify_session', email: currentUser.email }) });
                const res = await r.json();
                return res.status === "active";
            } catch { return false; }
        }

        async function handleAuthAction() {
            const email = document.getElementById('email-input').value.trim();
            const pass = document.getElementById('pass-input').value.trim();

            if (!email) {
                document.getElementById('no-email-box').style.display = 'block';
                return;
            }

            if (email && !pass) {
                // محاولة إرسال الكود
                const r = await fetch(VENS_URL, { method: 'POST', body: JSON.stringify({ action: 'check_email_only', email: email }) });
                const res = await r.json();
                alert(res.message);
                return;
            }

            // تسجيل دخول كامل
            const r = await fetch(VENS_URL, { method: 'POST', body: JSON.stringify({ action: 'login', email, password: pass }) });
            const res = await r.json();
            if (res.status === "success") {
                currentUser = { email, name: res.name };
                localStorage.setItem('eyc_user', JSON.stringify(currentUser));
                alert(`Welcome back, Agent ${res.name}`);
                location.reload();
            } else {
                alert(res.message);
            }
        }

        async function loadFloatingUI() {
            try {
                const r = await fetch(`${RANKS_URL}?name=${encodeURIComponent(currentUser.name)}`);
                const data = await r.json();
                if (!data.error) {
                    document.getElementById('profile-pic').src = data.image;
                    document.getElementById('token-val').innerText = data.tokens;
                    document.getElementById('rank-val').innerText = data.rank;
                    document.getElementById('floating-ui').style.display = 'flex';
                    document.getElementById('auth-modal').style.display = 'none';
                }
            } catch (e) { console.error("Ranks Load Error"); }
        }

        // --- إضافة كود الأنيميشن والـ Swiper من الكود القديم هنا ليعمل التصميم بالكامل ---
    </script>
</body>
</html>
