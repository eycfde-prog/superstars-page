// أضف هذا الجزء داخل ملف الأب سكريبت الحالي
function doPost(e) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName(CONFIG.SHEET_NAME);
  
  try {
    const data = JSON.parse(e.postData.contents);
    
    if (data.action === "signup") {
      // توليد كود فريد للعميل
      const agentCode = "EYC-" + Math.floor(1000 + Math.random() * 9000);
      
      // إضافة الصف الجديد
      // الترتيب: Timestamp, Name, Email, Age, Programs, Image, Code
      sheet.appendRow([
        new Date(), 
        data.name, 
        data.email.toLowerCase().trim(), 
        data.age, 
        data.programs, 
        data.image, 
        agentCode,
        "✅" // Attendance initial
      ]);
      
      return sendResponse({ 
        status: "success", 
        code: agentCode 
      });
    }
  } catch (err) {
    return sendResponse({ status: "error", message: err.toString() });
  }
}
