<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Forge Identity | EYC Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="npstyle.css">
</head>
<body>

    <div id="successScreen" class="modal">
        <div class="glass-card text-center w-full max-w-sm">
            <h2 class="orbitron text-2xl mb-6 text-yellow-500 font-black">IDENTITY FORGED</h2>
            
            <div class="flex flex-col items-center mb-6">
                <div class="p-1 rounded-full bg-yellow-500/20 mb-4">
                    <img id="finalAvatar" src="" class="w-32 h-32 rounded-full final-avatar-glow bg-black" alt="Hunter">
                </div>
                <h3 id="finalName" class="text-xl font-bold orbitron text-white">HUNTER NAME</h3>
                <p class="text-[9px] text-gray-500 mt-1">STATUS: ACTIVE OPERATIVE</p>
            </div>

            <div class="bg-black/60 border border-yellow-500/30 p-4 rounded-2xl mb-8">
                <span class="text-[10px] block text-gray-500 mb-1 orbitron">SECRET ACCESS CODE</span>
                <span id="displayStudentCode" class="text-3xl font-black text-white tracking-widest orbitron">----</span>
            </div>

            <button onclick="window.location.href='index.html'" class="btn-primary">ENTER HEADQUARTERS</button>
        </div>
    </div>

    <div class="main-container">
        <header class="text-center mb-8">
            <h1 class="orbitron text-3xl font-black text-white">FORGE <span class="text-yellow-500">IDENTITY</span></h1>
            <p class="text-gray-500 text-[10px] tracking-[3px]">EYC ACADEMY OPERATIVE SYSTEM</p>
        </header>

        <form id="regForm">
            <div class="step-content active" id="step1">
                <div class="glass-card">
                    <div class="avatar-preview-container">
                        <img id="avatarImg" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Browser" alt="Avatar">
                        <div class="mt-4">
                            <span class="text-yellow-500 orbitron text-[10px] tracking-widest">BIOMETRIC SYNCING...</span>
                        </div>
                    </div>

                    <div class="flex justify-center gap-4 mb-6">
                        <button type="button" onclick="randomizeAvatar()" class="p-3 bg-yellow-500 text-black rounded-xl">
                            <i class="fas fa-dice fa-lg"></i>
                        </button>
                        <div class="flex-1 flex items-center justify-around bg-white/5 rounded-xl border border-white/10 px-2 text-[18px]">
                            <span class="cursor-pointer" onclick="changePart('top')">üíá</span>
                            <span class="cursor-pointer" onclick="changePart('accessories')">üëì</span>
                            <span class="cursor-pointer" onclick="changePart('clothes')">üëî</span>
                            <span class="cursor-pointer" onclick="changePart('eyes')">üëÅÔ∏è</span>
                        </div>
                    </div>

                    <button type="button" class="btn-primary" onclick="nextStep(2)">PROCEED TO CLEARANCE</button>
                </div>
            </div>

            <div class="step-content" id="step2">
                <div class="glass-card">
                    <div class="mb-6">
                        <h2 class="orbitron text-yellow-500 text-sm mb-4"><i class="fas fa-id-card mr-2"></i> AGENT CLEARANCE</h2>
                        <div class="space-y-4">
                            <input type="text" name="fullName" id="userNameInput" required placeholder="FULL NAME (ENGLISH)" class="custom-input">
                            <input type="email" name="email" required placeholder="ACADEMY EMAIL" class="custom-input">
                            
                            <div class="grid grid-cols-2 gap-3">
                                <label class="checkbox-container">
                                    <input type="checkbox" name="prog" value="Season" class="accent-yellow-500">
                                    <span class="text-xs font-bold">Season</span>
                                </label>
                                <label class="checkbox-container">
                                    <input type="checkbox" id="xboxCheck" name="prog" value="XBoX" onchange="toggleXboxSection()" class="accent-blue-500">
                                    <span class="text-xs font-bold text-blue-400">XBoX Elite</span>
                                </label>
                            </div>

                            <div id="xboxSubMethod" class="hidden animate-pulse">
                                <select id="xboxPlan" class="custom-input text-blue-400 border-blue-900/50">
                                    <option value="Free">Free Access (Standard)</option>
                                    <option value="Elite">Elite Hunter (Premium)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <button type="submit" id="submitBtn" class="btn-primary">
                            <span id="btnText">FINALIZE IDENTITY</span>
                            <div id="loader" class="loader"></div>
                        </button>
                        <button type="button" onclick="nextStep(1)" class="btn-secondary">REVISE DESIGN</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx_Bqa-B-1PkEGT2JddeAsUergyKeHbgFiwSb8aUfps91PWQLDCyOpxvtS16VtsRIbcWg/exec";
        
        // Avatar Parts for Manual Selection
        let avatarParts = {
            top: ['longHair', 'shortHair', 'bob', 'shaggy', 'turban', 'hat'],
            accessories: ['none', 'kurt', 'prescription01', 'sunglasses'],
            clothes: ['blazerAndShirt', 'hoodie', 'overall', 'shirtVNeck'],
            eyes: ['default', 'happy', 'side', 'wink']
        };

        function randomizeAvatar() {
            const seed = Math.random().toString(36).substring(7);
            document.getElementById('avatarImg').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${seed}`;
        }

        function changePart(part) {
            // Simplified part changing for demo - just randomizes to show effect
            randomizeAvatar();
        }

        function nextStep(step) {
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
        }

        function toggleXboxSection() {
            const isChecked = document.getElementById('xboxCheck').checked;
            document.getElementById('xboxSubMethod').classList.toggle('hidden', !isChecked);
        }

        document.getElementById('regForm').onsubmit = async function(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            const btnText = document.getElementById('btnText');

            btnText.classList.add('hidden');
            loader.style.display = 'block';
            submitBtn.disabled = true;

            const formData = new FormData(this);
            const progs = [];
            document.querySelectorAll('input[name="prog"]:checked').forEach(c => progs.push(c.value));
            
            const avatarUrl = document.getElementById('avatarImg').src;
            const hunterName = document.getElementById('userNameInput').value;

            const data = {
                name: hunterName,
                email: formData.get('email'),
                programs: progs.join(', '),
                image: avatarUrl,
                xboxType: document.getElementById('xboxCheck').checked ? document.getElementById('xboxPlan').value : "None"
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Added to handle Apps Script CORS sometimes
                    body: JSON.stringify(data)
                });
                
                // Since we used no-cors, we'll assume success if it doesn't catch
                // In a production env, you'd handle the response object
                document.getElementById('finalAvatar').src = avatarUrl;
                document.getElementById('finalName').innerText = hunterName;
                document.getElementById('displayStudentCode').innerText = "ACT-" + Math.floor(100 + Math.random() * 900);
                document.getElementById('successScreen').style.display = 'flex';

            } catch (err) {
                alert("‚ö†Ô∏è UPLINK ERROR - BUT IDENTITY MIGHT BE SAVED");
                // Fallback for visual confirmation
                document.getElementById('successScreen').style.display = 'flex';
            } finally {
                btnText.classList.remove('hidden');
                loader.style.display = 'none';
                submitBtn.disabled = false;
            }
        };
    </script>
</body>
</html>
